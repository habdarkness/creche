generator client {
    provider      = "prisma-client-js"
    binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model User {
    id             Int     @id @default(autoincrement())
    name           String
    email          String  @unique
    phone          String  @unique
    password       String
    token_password String
    type           String
    level          Int     @default(3)
    active         Boolean @default(true)
    Class          Class?

    created_by String   @default("")
    created_at DateTime @default(now())
    reports    Report[]
    actions    Action[]
}

model Guardian {
    id          Int      @id @default(autoincrement())
    name        String
    birthday    DateTime
    cpf         String   @unique
    rg          String   @unique
    kinship     String
    phone       String
    workplace   String
    other_phone String

    dad_of      Student[] @relation("dad_of")
    mom_of      Student[] @relation("mom_of")
    guardian_of Student[] @relation("guardian_of")

    created_by String   @default("")
    created_at DateTime @default(now())
}

model Student {
    id           Int      @id @default(autoincrement())
    status       String
    name         String
    birthday     DateTime
    gender       String
    color        String
    twins        Boolean  @default(false)
    has_siblings Boolean  @default(false)
    //série
    class_id     Int?
    class        Class?   @relation(fields: [class_id], references: [id])

    // SUS
    sus Json

    //saúde e deficiências
    health_issues    String?
    food_restriction String?
    allergy          String?
    mobility         String?
    disabilities     Json?
    special_needs    String?
    classification   String?

    //família
    dad_id Int?
    dad    Guardian? @relation("dad_of", fields: [dad_id], references: [id])

    mom_id Int?
    mom    Guardian? @relation("mom_of", fields: [mom_id], references: [id])

    guardian_id Int?
    guardian    Guardian? @relation("guardian_of", fields: [guardian_id], references: [id])

    family     Json?
    authorized Json?

    gov_aid    Boolean @default(false)
    nis_number String?

    address  Address?
    document Documents?
    housing  Housing?
    asset    Assets?

    reports Report[]

    created_by String   @default("")
    created_at DateTime @default(now())
}

model Address {
    id           Int      @id @default(autoincrement())
    street       String?
    number       String?
    reference    String?
    neighborhood String?
    city         String?
    state        String?
    cep          String?
    phone_home   String?
    phone_alt    String?
    student_id   Int?     @unique
    student      Student? @relation(fields: [student_id], references: [id], onDelete: Cascade)
}

model Documents {
    id              Int       @id @default(autoincrement())
    birth_cert      String?
    registry_city   String?
    birth_city      String?
    registry_office String?
    cpf             String?
    rg              String?
    rg_issue_date   DateTime?
    rg_issuer       String?
    student_id      Int?      @unique
    student         Student?  @relation(fields: [student_id], references: [id], onDelete: Cascade)
}

model Housing {
    id            Int      @id @default(autoincrement())
    type          String?
    rent_value    Float?
    rooms         Int?
    floor_type    String?
    building_type String?
    roof_type     String?
    septic_tank   Boolean  @default(false)
    cifon         Boolean  @default(false)
    electricity   Boolean  @default(false)
    water         Boolean  @default(false)
    student_id    Int?     @unique
    student       Student? @relation(fields: [student_id], references: [id], onDelete: Cascade)
}

model Assets {
    id              Int      @id @default(autoincrement())
    tv              Boolean  @default(false)
    dvd             Boolean  @default(false)
    radio           Boolean  @default(false)
    computer        Boolean  @default(false)
    notebook        Boolean  @default(false)
    phone_fixed     Boolean  @default(false)
    phone_mobile    Boolean  @default(false)
    tablet          Boolean  @default(false)
    internet        Boolean  @default(false)
    cable_tv        Boolean  @default(false)
    stove           Boolean  @default(false)
    fridge          Boolean  @default(false)
    freezer         Boolean  @default(false)
    microwave       Boolean  @default(false)
    washing_machine Boolean  @default(false)
    air_conditioner Boolean  @default(false)
    bicycle         Boolean  @default(false)
    motorcycle      Boolean  @default(false)
    car             Boolean  @default(false)
    student_id      Int?     @unique
    student         Student? @relation(fields: [student_id], references: [id], onDelete: Cascade)
}

model Class {
    id    Int     @id @default(autoincrement())
    year  String?
    grade String?

    professor_id Int?  @unique
    professor    User? @relation(fields: [professor_id], references: [id])

    students Student[]

    created_by String   @default("")
    created_at DateTime @default(now())
}

model Report {
    id          Int      @id @default(autoincrement())
    title       String?
    description String?
    date        DateTime

    file Json?

    professor_id Int?
    professor    User? @relation(fields: [professor_id], references: [id])

    student_id Int?
    student    Student? @relation(fields: [student_id], references: [id])

    created_by String   @default("")
    created_at DateTime @default(now())
}

model Action {
    id          Int      @id @default(autoincrement())
    user_id     Int?
    user        User?    @relation(fields: [user_id], references: [id])
    user_name   String?
    description String
    created_at  DateTime @default(now())
}
